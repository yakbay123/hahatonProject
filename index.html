<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K54 Store & Aggregator</title>
    <style>

        :root {
            --bg-dark: #121212;
            --bg-panel: #2b2b2b; 
            --bg-input: #A0A0A0; 
            --text-main: #ffffff;
            --text-muted: #b3b3b3;
            --accent: #8c8c8c; 
            --hover: #a8a8a8;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }


        header {
            background-color: #333;
            padding: 15px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            border-bottom: 1px solid #444;
            height: 80px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            width: 50px;
            height: 50px;
            cursor: pointer;
        }
        .logo svg {
            width: 100%;
            height: 100%;
            fill: white;
        }

        .search-container {
            flex-grow: 1;
            max-width: 800px;
            margin: 0 20px;
            position: relative;
        }

        .search-bar {
            width: 100%;
            background-color: var(--bg-input);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 5px 5px 5px 20px;
        }

        .search-bar input {
            background: transparent;
            border: none;
            outline: none;
            flex-grow: 1;
            font-size: 16px;
            color: #333;
        }
        .search-bar input::placeholder { color: #555; }

        .search-btn {
            background-color: #8e8e8e;
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        .search-btn:hover { background-color: #777; }

        .search-history {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: #333;
            border: 1px solid #444;
            border-top: none;
            border-radius: 0 0 8px 8px;
            display: none;
            z-index: 1001;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .search-history.active { display: block; }
        .history-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #444;
            color: #ccc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-item:hover { background-color: #444; color: white; }
        .remove-history-item { color: #888; font-size: 12px; }
        .remove-history-item:hover { color: #fff; }

        .header-actions { display: flex; gap: 25px; }
        .action-item {
            display: flex; flex-direction: column; align-items: center; cursor: pointer;
            color: white; font-size: 12px; background: none; border: none; position: relative;
        }
        .action-item:hover { opacity: 0.8; }
        .action-item svg { width: 24px; height: 24px; margin-bottom: 4px; fill: white; }
        .badge-count {
            position: absolute; top: -5px; right: -5px; background: red; color: white;
            font-size: 10px; padding: 2px 5px; border-radius: 50%; display: none;
        }

        main {
            padding: 20px 40px;
            flex-grow: 1;
            position: relative;
            display: flex;
            gap: 30px;
        }

        .sidebar {
            width: 250px;
            flex-shrink: 0;
            background: var(--bg-panel);
            padding: 20px;
            border-radius: 8px;
            height: fit-content;
            display: none; 
        }
        .sidebar h3 { margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px; font-weight: 400; }
        .filter-group { margin-bottom: 20px; }
        .filter-label { display: block; margin-bottom: 8px; font-size: 14px; color: var(--text-muted); }
        .filter-input { width: 100%; background: var(--bg-dark); border: 1px solid #555; color: white; padding: 8px; border-radius: 4px; margin-bottom: 5px; }
        .checkbox-group label { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; cursor: pointer; font-size: 14px; }
        .apply-btn { width: 100%; background: #555; color: white; border: none; padding: 10px; border-radius: 4px; cursor: pointer; margin-top: 10px; }
        .apply-btn:hover { background: #666; }

        .scrollable-group {
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px;
        }
        .scrollable-group::-webkit-scrollbar { width: 6px; }
        .scrollable-group::-webkit-scrollbar-track { background: #2b2b2b; }
        .scrollable-group::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }
        .scrollable-group::-webkit-scrollbar-thumb:hover { background: #777; }


        .content-area { flex-grow: 1; }

        .catalog-nav {
            background-color: #3a3a3a; padding: 10px 20px; border-radius: 8px;
            display: flex; align-items: center; gap: 30px; margin-bottom: 20px;
            position: relative; z-index: 100;
        }
        .nav-btn {
            background: none; border: none; color: white; font-size: 15px; cursor: pointer;
            display: flex; align-items: center; gap: 5px; padding: 10px 0;
        }
        .nav-btn:hover { color: #ddd; }
        .nav-btn::after { content: '‚åÑ'; font-size: 12px; transform: translateY(-2px); }

        .mega-menu {
            position: absolute; top: 100%; left: 0; width: 100%;
            background-color: #3a3a3a; border-radius: 0 0 8px 8px; padding: 30px;
            display: none; grid-template-columns: repeat(4, 1fr); gap: 40px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5); z-index: 200;
        }
        .mega-menu.active { display: grid; }
        .menu-category h3 { font-size: 18px; margin-bottom: 15px; color: white; font-weight: 400; }
        .menu-category ul { list-style: none; }
        .menu-category li { margin-bottom: 8px; }
        .menu-category a { text-decoration: none; color: #ccc; font-size: 14px; }
        .menu-category a:hover { color: white; }
        .menu-title-main { grid-column: 1 / -1; font-size: 24px; margin-bottom: 10px; border-bottom: 1px solid #555; padding-bottom: 10px; }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: var(--bg-panel);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s;
            cursor: pointer;
            border: 1px solid #3a3a3a;
            display: flex;
            flex-direction: column;
            min-height: 320px;
        }
        .product-card:hover { transform: translateY(-5px); border-color: #555; }

        .card-img-wrapper {
            height: 180px; width: 100%; background-color: #444;
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .card-img { font-size: 50px; }
        
        .source-badge { position: absolute; top: 10px; left: 10px; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; color: white; }
        .badge-wb { background-color: #cb11ab; }
        .badge-ozon { background-color: #005bff; }
        .badge-ym { background-color: #fc3; color: black; }

        .card-info { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; }
        .card-brand { font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 4px; }
        .card-title { font-size: 14px; margin-bottom: 10px; line-height: 1.3; color: #eee; }
        .card-price-block { margin-top: auto; }
        .card-price { font-size: 18px; font-weight: bold; display: flex; align-items: center; gap: 8px; }
        .old-price { font-size: 13px; text-decoration: line-through; color: #777; }
        .discount-badge { background: #ff4444; font-size: 11px; padding: 2px 5px; border-radius: 4px; }
        .card-meta { display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px; color: #888; }

        .fav-btn-card {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5);
            border: none; border-radius: 50%; width: 30px; height: 30px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            opacity: 0; transition: 0.2s;
        }
        .product-card:hover .fav-btn-card { opacity: 1; }
        .fav-btn-card.active { opacity: 1; background: rgba(255,255,255,0.2); }
        .fav-btn-card svg { width: 16px; height: 16px; fill: none; stroke: white; stroke-width: 2; }
        .fav-btn-card.active svg { fill: #ff4444; stroke: #ff4444; }

        .page { display: none; }
        .page.active { display: block; }

        .login-container { display: flex; justify-content: center; align-items: center; height: 70vh; }
        .login-card { background: #333; padding: 40px; border-radius: 20px; width: 380px; text-align: center; }
        .login-input { width: 100%; padding: 12px; border-radius: 20px; border: none; background: var(--bg-input); margin-bottom: 15px; outline: none; }
        .btn-login { background: #555; color: white; border: none; padding: 12px; width: 100%; border-radius: 15px; cursor: pointer; }
        .btn-login:hover { background: #666; }
        .divider { margin: 20px 0; display: flex; align-items: center; color: #777; font-size: 14px; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: #555; margin: 0 10px; }
        .btn-alt { width: 100%; background: #444; color: #ccc; border: none; padding: 10px; border-radius: 20px; margin-bottom: 10px; cursor: pointer; }

        .favorites-container, .account-card { background: #333; min-height: 60vh; border-radius: 10px; padding: 40px; }
        .favorites-container { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .fav-icon { border: 2px solid white; border-radius: 10px; width: 80px; height: 60px; position: relative; margin-bottom: 20px; display: flex; justify-content: center; align-items: center;}
        .fav-icon.tag::before { content: ''; position: absolute; top: -10px; left: 0; width: 30px; height: 10px; border: 2px solid white; border-bottom: none; border-radius: 5px 5px 0 0; }
        
        .account-card { display: flex; gap: 30px; }
        .avatar-placeholder { width: 100px; height: 100px; background: white; border-radius: 50%; display: flex; justify-content: center; align-items: end; overflow: hidden; }
        .avatar-placeholder svg { width: 80%; height: 80%; fill: #333; }

        .error-msg { color: #ff6b6b; margin-top: 10px; font-size: 14px; display: none; }

    </style>
</head>
<body>

    <header>
        <div class="logo" onclick="router('home')">
            <svg viewBox="0 0 100 100">
                <path d="M10,10 L10,90 L30,90 L30,60 L60,90 L90,90 L50,50 L90,10 L60,10 L30,40 L30,10 Z" stroke="white" stroke-width="2" fill="none"/>
                <text x="35" y="85" font-size="20" fill="white">54</text>
            </svg>
        </div>

        <div class="search-container">
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." autocomplete="off">
                <button class="search-btn" onclick="app.handleSearch()">–ù–∞–π—Ç–∏</button>
            </div>
            <div class="search-history" id="search-history-dropdown"></div>
        </div>

        <div class="header-actions">
            <button class="action-item" onclick="router('favorites')">
                <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                <div id="fav-count" class="badge-count">0</div>
            </button>
            <button class="action-item" onclick="router('cart')">
                <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
            </button>
            <button class="action-item" id="auth-btn" onclick="handleAuthClick()">
                <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                <span id="auth-text">–í–æ–π—Ç–∏</span>
            </button>
        </div>
    </header>

    <main id="app">
        
        <aside class="sidebar" id="sidebar-panel">
            <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
            
            <div class="filter-group">
                <span class="filter-label">–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã:</span>
                <div class="checkbox-group">
                    <label><input type="checkbox" checked value="wb" onchange="app.applyFilters()"> Wildberries</label>
                    <label><input type="checkbox" checked value="ozon" onchange="app.applyFilters()"> Ozon</label>
                    <label><input type="checkbox" checked value="ym" onchange="app.applyFilters()"> –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç</label>
                </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">–¶–µ–Ω–∞ (‚ÇΩ):</span>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="price-min" placeholder="–û—Ç" class="filter-input" onchange="app.applyFilters()">
                    <input type="number" id="price-max" placeholder="–î–æ" class="filter-input" onchange="app.applyFilters()">
                </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">–ë—Ä–µ–Ω–¥—ã:</span>
                <div id="brand-filters-container" class="checkbox-group scrollable-group">
                    </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥:</span>
                <select id="rating-min" class="filter-input" onchange="app.applyFilters()">
                    <option value="0">–õ—é–±–æ–π</option>
                    <option value="4.5">4.5+</option>
                    <option value="4.0">4.0+</option>
                    <option value="3.0">3.0+</option>
                </select>
            </div>

            <button class="apply-btn" onclick="app.applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </aside>

        <div class="content-area">
            <div id="page-home" class="page active">
                
                <div class="catalog-nav">
                    <svg class="filter-icon" width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                    </svg>
                    <button class="nav-btn" onclick="toggleMegaMenu('clothing')">–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å</button>
                    <button class="nav-btn" onclick="toggleMegaMenu('home')">–î–æ–º</button>
                    <button class="nav-btn" onclick="toggleMegaMenu('kids')">–î–µ—Ç—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã</button>
                    <button class="nav-btn" onclick="toggleMegaMenu('beauty')">–ö—Ä–∞—Å–æ—Ç–∞</button>
                    <button class="nav-btn" onclick="toggleMegaMenu('electronics')">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
                    <button class="nav-btn">–í—Å–µ</button>

                    <div id="mega-menu-container" class="mega-menu"></div>
                </div>

                <div class="product-grid" id="product-grid">
                    </div>
            </div>

            <div id="page-login" class="page">
                <div class="login-container">
                    <div class="login-card">
                        <h1 class="login-title">–í—Ö–æ–¥</h1>
                        <div class="input-group">
                            <label>–õ–æ–≥–∏–Ω</label>
                            <input type="text" id="login-user" class="login-input">
                        </div>
                        <div class="input-group">
                            <label>–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="login-pass" class="login-input">
                        </div>
                        <button class="btn-login" onclick="performLogin()">–í–æ–π—Ç–∏</button>
                        <p id="login-error" class="error-msg">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</p>
                        <div class="divider"><span>–ò–ª–∏</span></div>
                        <button class="btn-alt">–í—Ö–æ–¥ –ø–æ –ø–æ—á—Ç–µ</button>
                        <button class="btn-alt">–í—Ö–æ–¥ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É</button>
                    </div>
                </div>
            </div>

            <div id="page-account" class="page">
                <div class="account-card">
                    <div class="avatar-placeholder">
                        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    </div>
                    <div class="user-info">
                        <h2 id="account-name">–ò–º—è: </h2>
                        <button class="btn-login" style="margin-top: 20px;" onclick="performLogout()">–í—ã–π—Ç–∏</button>
                    </div>
                </div>
            </div>

            <div id="page-favorites" class="page">
                <h1 style="margin-bottom: 20px;">–ò–∑–±—Ä–∞–Ω–æ–µ</h1>
                <div class="favorites-container" id="fav-container-empty">
                    <div class="fav-icon tag">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="white" style="margin-top:2px;"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </div>
                    <div class="fav-text">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–æ–∫–∞<br>–ø—É—Å—Ç–æ</div>
                </div>
                <div id="fav-grid" class="product-grid" style="display: none;"></div>
            </div>
            
            <div id="page-cart" class="page">
                <h1 style="margin-bottom: 20px;">–ö–æ—Ä–∑–∏–Ω–∞</h1>
                <div class="favorites-container" id="cart-container-empty">
                    <div class="fav-icon" style="background: none; border: 2px solid white;">
                        <svg width="30" height="30" viewBox="0 0 24 24" fill="white" style="margin-top:2px;"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
                    </div>
                    <div class="fav-text">–í –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–∫–∞<br>–ø—É—Å—Ç–æ</div>
                </div>
                </div>
            </div>
    </main>

    <script>
        const rawData = [
            { id: 1, title: "–°–º–∞—Ä—Ç—Ñ–æ–Ω Apple iPhone 15 128GB", brand: "Apple", price: 89000, oldPrice: 95000, rating: 4.9, reviews: 120, source: "ozon", image: "üì±" },
            { id: 2, title: "–ö—Ä–æ—Å—Å–æ–≤–∫–∏ Nike Air Force 1", brand: "Nike", price: 12500, oldPrice: 15000, rating: 4.7, reviews: 45, source: "wb", image: "üëü" },
            { id: 3, title: "–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞ DeLonghi Magnifica", brand: "DeLonghi", price: 35000, oldPrice: 42000, rating: 4.8, reviews: 300, source: "ym", image: "‚òï" },
            { id: 4, title: "–§—É—Ç–±–æ–ª–∫–∞ –±–∞–∑–æ–≤–∞—è (—Ö–ª–æ–ø–æ–∫)", brand: "–¢–≤–æ–µ", price: 800, oldPrice: 1200, rating: 4.2, reviews: 1500, source: "wb", image: "üëï" },
            { id: 5, title: "–ù–æ—É—Ç–±—É–∫ ASUS Vivobook Go", brand: "ASUS", price: 45000, oldPrice: 50000, rating: 4.5, reviews: 80, source: "ozon", image: "üíª" },
            { id: 6, title: "–£–º–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ –Ø–Ω–¥–µ–∫—Å –°—Ç–∞–Ω—Ü–∏—è", brand: "–Ø–Ω–¥–µ–∫—Å", price: 17990, oldPrice: 17990, rating: 5.0, reviews: 500, source: "ym", image: "üîä" },
            { id: 7, title: "–ß–µ—Ö–æ–ª –¥–ª—è iPhone 15", brand: "Noname", price: 300, oldPrice: 500, rating: 3.8, reviews: 20, source: "wb", image: "üì±" },
            { id: 8, title: "–†–æ–±–æ—Ç-–ø—ã–ª–µ—Å–æ—Å Xiaomi", brand: "Xiaomi", price: 15000, oldPrice: 22000, rating: 4.6, reviews: 210, source: "ozon", image: "üßπ" },
            { id: 9, title: "–ù–∞—É—à–Ω–∏–∫–∏ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ Sony", brand: "Sony", price: 8000, oldPrice: 9500, rating: 4.7, reviews: 150, source: "ym", image: "üéß" },
            { id: 10, title: "–ù–∞–±–æ—Ä LEGO Star Wars", brand: "LEGO", price: 6000, oldPrice: 7000, rating: 4.9, reviews: 45, source: "ozon", image: "üß±" },
            { id: 11, title: "–ö—Ä–µ–º —É–≤–ª–∞–∂–Ω—è—é—â–∏–π CeraVe", brand: "CeraVe", price: 1200, oldPrice: 1600, rating: 4.8, reviews: 1200, source: "wb", image: "üß¥" },
            { id: 12, title: "–¢–µ–ª–µ–≤–∏–∑–æ—Ä Samsung 50\" 4K", brand: "Samsung", price: 45000, oldPrice: 55000, rating: 4.6, reviews: 90, source: "ym", image: "üì∫" }
        ];

        const usersDB = [{ username: "admin", password: "123", fullName: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" }];

        const app = {
            data: rawData,
            favorites: JSON.parse(localStorage.getItem('agg_favorites')) || [],
            history: JSON.parse(localStorage.getItem('agg_history')) || [],
            currentUser: JSON.parse(localStorage.getItem('agg_user')) || null,
            filters: {
                sources: ['wb', 'ozon', 'ym'],
                brands: [],
                minPrice: 0,
                maxPrice: 999999,
                minRating: 0,
                search: ''
            },

            init() {
                this.setupListeners();
                this.generateBrandFilters();
                this.checkAuth();
                this.updateFavCounter();
                
                if(!document.querySelector('.page.active')) {
                    this.router('home');
                } else {
                    this.render();
                }
            },

            setupListeners() {
                const searchInput = document.getElementById('search-input');
                const historyDropdown = document.getElementById('search-history-dropdown');

                searchInput.addEventListener('focus', () => {
                    this.renderHistory();
                    if (this.history.length > 0) historyDropdown.classList.add('active');
                });

                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.search-container')) {
                        historyDropdown.classList.remove('active');
                    }
                });

                searchInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') this.handleSearch();
                });
            },

            generateBrandFilters() {
                const container = document.getElementById('brand-filters-container');
                if (!container) return;
                const allBrands = [...new Set(this.data.map(item => item.brand))].sort();
                
                container.innerHTML = '';
                allBrands.forEach(brand => {
                    const label = document.createElement('label');
                    label.innerHTML = `<input type="checkbox" value="${brand}" onchange="app.applyFilters()"> ${brand}`;
                    container.appendChild(label);
                });
            },

            getProcessedData() {
                return this.data.filter(item => {
                    const matchSource = this.filters.sources.includes(item.source);
                    const matchPrice = item.price >= this.filters.minPrice && item.price <= this.filters.maxPrice;
                    const matchRating = item.rating >= this.filters.minRating;
                    const matchSearch = item.title.toLowerCase().includes(this.filters.search.toLowerCase());
                    const matchBrand = this.filters.brands.length === 0 || this.filters.brands.includes(item.brand);

                    return matchSource && matchPrice && matchRating && matchSearch && matchBrand;
                });
            },

            applyFilters() {
                const sourceCheckboxes = document.querySelectorAll('.checkbox-group:not(#brand-filters-container) input:checked');
                this.filters.sources = Array.from(sourceCheckboxes).map(cb => cb.value);
                
                const brandCheckboxes = document.querySelectorAll('#brand-filters-container input:checked');
                this.filters.brands = Array.from(brandCheckboxes).map(cb => cb.value);

                this.filters.minPrice = Number(document.getElementById('price-min').value) || 0;
                this.filters.maxPrice = Number(document.getElementById('price-max').value) || 999999;
                this.filters.minRating = Number(document.getElementById('rating-min').value);

                this.render();
            },

            handleSearch() {
                const query = document.getElementById('search-input').value.trim();
                this.filters.search = query;
                
                if (query) {
                    this.history = [query, ...this.history.filter(h => h !== query)].slice(0, 5);
                    localStorage.setItem('agg_history', JSON.stringify(this.history));
                }
                document.getElementById('search-history-dropdown').classList.remove('active');
                this.router('home');
                this.render();
            },

            renderHistory() {
                const container = document.getElementById('search-history-dropdown');
                container.innerHTML = '';
                if(this.history.length === 0) {
                    container.innerHTML = '<div style="padding:10px; color:#777; text-align:center;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
                    return;
                }
                this.history.forEach(text => {
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <span onclick="app.applyHistorySearch('${text}')">${text}</span>
                        <span class="remove-history-item" onclick="event.stopPropagation(); app.removeHistory('${text}')">‚úï</span>
                    `;
                    container.appendChild(div);
                });
            },
            applyHistorySearch(text) {
                document.getElementById('search-input').value = text;
                this.handleSearch();
            },
            removeHistory(text) {
                this.history = this.history.filter(h => h !== text);
                localStorage.setItem('agg_history', JSON.stringify(this.history));
                this.renderHistory();
            },

            router(pageName) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                
                const pageElement = document.getElementById(`page-${pageName}`);
                if (pageElement) {
                    pageElement.classList.add('active');
                } else {
                    document.getElementById('page-home').classList.add('active');
                }
                
                const sidebar = document.getElementById('sidebar-panel');
                if (sidebar) sidebar.style.display = (pageName === 'home') ? 'block' : 'none';
                
                if (pageName === 'favorites') this.renderFavorites();
        
                document.getElementById('mega-menu-container').classList.remove('active');
            },

            // --- AUTH ---
            checkAuth() {
                if (this.currentUser) {
                    document.getElementById('account-name').innerText = "–ò–º—è: " + this.currentUser.fullName;
                    document.getElementById('auth-text').innerText = this.currentUser.fullName.split(' ')[0];
                } else {
                    document.getElementById('auth-text').innerText = "–í–æ–π—Ç–∏";
                }
            },


            render() {
                const products = this.getProcessedData();
                const grid = document.getElementById('product-grid');
                grid.innerHTML = '';

                if (products.length === 0) {
                    grid.innerHTML = '<div style="grid-column: 1/-1; text-align:center; padding:40px; color:#888;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }
                products.forEach(item => grid.appendChild(this.createCard(item)));
            },

            renderFavorites() {
                const grid = document.getElementById('fav-grid');
                const empty = document.getElementById('fav-container-empty');
                grid.innerHTML = '';
                
                if (this.favorites.length === 0) {
                    empty.style.display = 'flex';
                    grid.style.display = 'none';
                } else {
                    empty.style.display = 'none';
                    grid.style.display = 'grid';
                    const favItems = this.data.filter(i => this.favorites.includes(i.id));
                    favItems.forEach(item => grid.appendChild(this.createCard(item)));
                }
            },

            createCard(item) {
                const isFav = this.favorites.includes(item.id);
                const div = document.createElement('div');
                div.className = 'product-card';
                div.onclick = () => alert(`–ë—Ä–µ–Ω–¥: ${item.brand}\n–¢–æ–≤–∞—Ä: ${item.title}`);
                
                let badgeClass = '', badgeText = '';
                if(item.source === 'wb') { badgeClass = 'badge-wb'; badgeText = 'Wildberries'; }
                if(item.source === 'ozon') { badgeClass = 'badge-ozon'; badgeText = 'Ozon'; }
                if(item.source === 'ym') { badgeClass = 'badge-ym'; badgeText = '–Ø–Ω–¥–µ–∫—Å'; }

                const discount = Math.round(((item.oldPrice - item.price) / item.oldPrice) * 100);

                div.innerHTML = `
                    <div class="card-img-wrapper">
                        <div class="card-img">${item.image}</div>
                        <span class="source-badge ${badgeClass}">${badgeText}</span>
                        <button class="fav-btn-card ${isFav ? 'active' : ''}" onclick="event.stopPropagation(); app.toggleFav(${item.id}, this)">
                            <svg><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                        </button>
                    </div>
                    <div class="card-info">
                        <div class="card-brand">${item.brand}</div>
                        <div class="card-title">${item.title}</div>
                        <div class="card-meta">
                            <span>‚òÖ ${item.rating}</span>
                            <span>${item.reviews} –æ—Ç–∑.</span>
                        </div>
                        <div class="card-price-block">
                            <div class="card-price">
                                ${item.price.toLocaleString()} ‚ÇΩ 
                                ${discount > 0 ? `<span class="discount-badge">-${discount}%</span>` : ''}
                            </div>
                            ${item.oldPrice > item.price ? `<div class="old-price">${item.oldPrice.toLocaleString()} ‚ÇΩ</div>` : ''}
                        </div>
                    </div>
                `;
                return div;
            },

            toggleFav(id, btnElement) {
                if (this.favorites.includes(id)) {
                    this.favorites = this.favorites.filter(favId => favId !== id);
                    btnElement.classList.remove('active');
                } else {
                    this.favorites.push(id);
                    btnElement.classList.add('active');
                }
                localStorage.setItem('agg_favorites', JSON.stringify(this.favorites));
                this.updateFavCounter();
                
                if(document.getElementById('page-favorites').classList.contains('active')) {
                    this.renderFavorites();
                }
            },
            updateFavCounter() {
                const el = document.getElementById('fav-count');
                el.style.display = this.favorites.length > 0 ? 'block' : 'none';
                el.innerText = this.favorites.length;
            }
        };

        function router(p) { app.router(p); }
        function handleAuthClick() { app.currentUser ? app.router('account') : app.router('login'); }
        function performLogin() { app.performLogin(); } 
        function performLogout() { app.performLogout(); }

        app.performLogin = function() {
            const u = document.getElementById('login-user').value;
            const p = document.getElementById('login-pass').value;
            const found = usersDB.find(user => user.username === u && user.password === p);
            if (found) {
                this.currentUser = found;
                localStorage.setItem('agg_user', JSON.stringify(found));
                document.getElementById('login-error').style.display = 'none';
                this.checkAuth();
                this.router('account');
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }
        app.performLogout = function() {
            this.currentUser = null;
            localStorage.removeItem('agg_user');
            this.checkAuth();
            this.router('login');
        }

        const menuData = {
            clothing: `
                <div class="menu-title-main">–û–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å</div>
                <div class="menu-category">
                    <h3>–ñ–µ–Ω—â–∏–Ω–∞–º</h3>
                    <ul>
                        <li><a href="#">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</a></li>
                        <li><a href="#">–ë–ª—É–∑—ã –∏ —Ä—É–±–∞—à–∫–∏</a></li>
                        <li><a href="#">–ë–æ–¥–∏</a></li>
                        <li><a href="#">–ë—Ä—é–∫–∏</a></li>
                        <li><a href="#">–í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞</a></li>
                    </ul>
                    <h3>–û–±—É–≤—å</h3>
                    <ul>
                        <li><a href="#">–ñ–µ–Ω—Å–∫–∞—è –æ–±—É–≤—å</a></li>
                        <li><a href="#">–ú—É–∂—Å–∫–∞—è –æ–±—É–≤—å</a></li>
                        <li><a href="#">–î–ª—è –¥–µ–≤–æ—á–µ–∫</a></li>
                        <li><a href="#">–î–ª—è –º–∞–ª—å—á–∏–∫–æ–≤</a></li>
                        <li><a href="#">–î–ª—è –º–∞–ª—ã—à–µ–π</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–ú—É–∂—á–∏–Ω–∞–º</h3>
                    <ul>
                        <li><a href="#">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</a></li>
                        <li><a href="#">–í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞</a></li>
                        <li><a href="#">–ë—Ä—é–∫–∏ –∏ —à—Ç–∞–Ω—ã</a></li>
                        <li><a href="#">–í–æ–¥–æ–ª–∞–∑–∫–∏</a></li>
                        <li><a href="#">–ë—Ä—é–∫–∏</a></li>
                        <li><a href="#">–°–≤–∏—Ç–µ—Ä—ã</a></li>
                    </ul>
                    <h3>–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</h3>
                    <ul>
                        <li><a href="#">–°—É–º–∫–∏, —Ä—é–∫–∑–∞–∫–∏, —á–µ–º–æ–¥–∞–Ω—ã</a></li>
                        <li><a href="#">–ö–æ—à–µ–ª—å–∫–∏, –≤–∏–∑–∏—Ç–Ω–∏—Ü—ã, –∫–æ—Å–º–µ—Ç–∏—á–∫–∏</a></li>
                        <li><a href="#">–Æ–≤–µ–ª–∏—Ä–Ω—ã–µ —É–∫—Ä–∞—à–µ–Ω–∏—è</a></li>
                        <li><a href="#">–ë–∏–∂—É—Ç–µ—Ä–∏—è</a></li>
                        <li><a href="#">–ß–∞—Å—ã</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–î–µ—Ç—è–º</h3>
                    <ul>
                        <li><a href="#">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</a></li>
                        <li><a href="#">–î–ª—è –¥–µ–≤–æ—á–µ–∫</a></li>
                        <li><a href="#">–î–ª—è –º–∞–ª—å—á–∏–∫–æ–≤</a></li>
                        <li><a href="#">–î–ª—è –º–∞–ª—ã—à–µ–π</a></li>
                        <li><a href="#">–û–±—É–≤—å</a></li>
                    </ul>
                </div>
            `,
            home: `
                <div class="menu-title-main">–î–æ–º</div>
                <div class="menu-category">
                    <h3>–ü–æ—Å—É–¥–∞</h3>
                    <ul>
                        <li><a href="#">–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –ø–∏—â–∏</a></li>
                        <li><a href="#">–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–ø–∏—Ç–∫–æ–≤</a></li>
                        <li><a href="#">–ù–æ–∂–∏</a></li>
                        <li><a href="#">–†–∞–∑–¥–µ–ª–æ—á–Ω—ã–µ –¥–æ—Å–∫–∏</a></li>
                        <li><a href="#">–¢–µ—Ä–º–æ—Å—ã –∏ —Ç–µ—Ä–º–æ–∫—Ä—É–∂–∫–∏</a></li>
                    </ul>
                    <h3>–ò–Ω—Ç–µ—Ä—å–µ—Ä</h3>
                    <ul>
                        <li><a href="#">–ó–µ—Ä–∫–∞–ª–∞</a></li>
                        <li><a href="#">–®—Ç–æ—Ä—ã, –∫–∞—Ä–Ω–∏–∑—ã, –¥–µ–∫–æ—Ä –æ–∫–Ω–∞</a></li>
                        <li><a href="#">–†–∞—Å—Ç–µ–Ω–∏—è, –∫–∞—à–ø–æ, –≥–æ—Ä—à–∫–∏</a></li>
                        <li><a href="#">–î–µ–∫–æ—Ä —Å—Ç–µ–Ω</a></li>
                        <li><a href="#">–î–µ–∫–æ—Ä –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –¥–æ–º–µ</h3>
                    <ul>
                        <li><a href="#">–ö–æ—Ä–∑–∏–Ω—ã, –∫–æ—Ä–æ–±–∫–∏ –∏ –æ—Ä–≥–∞–Ω–∞–π–∑–µ—Ä—ã</a></li>
                        <li><a href="#">–í–∞–∫—É—É–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã</a></li>
                        <li><a href="#">–í–µ—à–∞–ª–∫–∏ –Ω–∞–ø–æ–ª—å–Ω—ã–µ</a></li>
                        <li><a href="#">–í–µ—à–∞–ª–∫–∏ –Ω–∞—Å—Ç–µ–Ω–Ω—ã–µ</a></li>
                        <li><a href="#">–í–µ—à–∞–ª–∫–∏-–ø–ª–µ—á–∏–∫–∏</a></li>
                    </ul>
                    <h3>–ú–µ–±–µ–ª—å</h3>
                    <ul>
                        <li><a href="#">–ú—è–≥–∫–∞—è –º–µ–±–µ–ª—å</a></li>
                        <li><a href="#">–ì–∞—Ä–¥–µ—Ä–æ–±—ã, —à–∫–∞—Ñ—ã –∏ –∫–æ–º–æ–¥—ã</a></li>
                        <li><a href="#">–ö—É—Ö–æ–Ω–Ω—ã–µ —Å—Ç–æ–ª—ã –∏ —Å—Ç—É–ª—å—è</a></li>
                        <li><a href="#">–†–∞–±–æ—á–∏–µ –º–µ—Å—Ç–∞</a></li>
                        <li><a href="#">–ú–µ–±–µ–ª—å –¥–ª—è —Å–ø–∞–ª—å–Ω–∏</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–¢–µ–∫—Å—Ç–∏–ª—å</h3>
                    <ul>
                        <li><a href="#">–ü–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å–µ</a></li>
                        <li><a href="#">–ü–æ–¥—É—à–∫–∏</a></li>
                        <li><a href="#">–û–¥–µ—è–ª–∞</a></li>
                        <li><a href="#">–ù–∞–º–∞—Ç—Ä–∞—Å–Ω–∏–∫–∏ –∏ —á–µ—Ö–ª—ã –¥–ª—è –º–∞—Ç—Ä–∞—Å–æ–≤</a></li>
                        <li><a href="#">–ü–ª–µ–¥—ã –∏ –ø–æ–∫—Ä—ã–≤–∞–ª–∞</a></li>
                    </ul>
                </div>
            `,
            kids: `
                <div class="menu-title-main">–î–µ—Ç—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã</div>
                <div class="menu-category">
                    <h3>–ò–≥—Ä—É—à–∫–∏ –∏ —Ö–æ–±–±–∏</h3>
                    <ul>
                        <li><a href="#">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (LEGO, Sluban)</a></li>
                        <li><a href="#">–†–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∏–≥—Ä—ã</a></li>
                        <li><a href="#">–ù–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã</a></li>
                        <li><a href="#">–†–∞–¥–∏–æ—É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –º–æ–¥–µ–ª–∏</a></li>
                    </ul>
                    <h3>–î–ª—è –º–ª–∞–¥–µ–Ω—Ü–µ–≤</h3>
                    <ul>
                        <li><a href="#">–ü–æ–¥–≥—É–∑–Ω–∏–∫–∏ –∏ –ø–µ–ª–µ–Ω–∫–∏</a></li>
                        <li><a href="#">–î–µ—Ç—Å–∫–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –∏ —Å–º–µ—Å–∏</a></li>
                        <li><a href="#">–ë—É—Ç—ã–ª–æ—á–∫–∏ –∏ —Å–æ—Å–∫–∏</a></li>
                        <li><a href="#">–ö–æ–ª—è—Å–∫–∏ –∏ –∞–≤—Ç–æ–∫—Ä–µ—Å–ª–∞</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–î–µ—Ç—Å–∫–∞—è –æ–¥–µ–∂–¥–∞ –∏ –æ–±—É–≤—å</h3>
                    <ul>
                        <li><a href="#">–í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞</a></li>
                        <li><a href="#">–ü–ª–∞—Ç—å—è –∏ —é–±–∫–∏</a></li>
                        <li><a href="#">–ö–æ—Å—Ç—é–º—ã –∏ –∫–æ–º–ø–ª–µ–∫—Ç—ã</a></li>
                        <li><a href="#">–ë–æ—Ç–∏–Ω–∫–∏, —Å–∞–ø–æ–≥–∏</a></li>
                        <li><a href="#">–ö—Ä–æ—Å—Å–æ–≤–∫–∏, –∫–µ–¥—ã</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∏ –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—è</h3>
                    <ul>
                        <li><a href="#">–ù–∞–±–æ—Ä—ã –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è</a></li>
                        <li><a href="#">–ü–ª–∞—Å—Ç–∏–ª–∏–Ω –∏ –≥–ª–∏–Ω–∞</a></li>
                        <li><a href="#">–ö–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏</a></li>
                        <li><a href="#">–†—é–∫–∑–∞–∫–∏ –∏ –ø–µ–Ω–∞–ª—ã</a></li>
                    </ul>
                </div>
            `,
            beauty: `
                <div class="menu-title-main">–ö—Ä–∞—Å–æ—Ç–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ</div>
                <div class="menu-category">
                    <h3>–£—Ö–æ–¥ –∑–∞ –∫–æ–∂–µ–π</h3>
                    <ul>
                        <li><a href="#">–î–ª—è –ª–∏—Ü–∞ (–ö—Ä–µ–º—ã, –°—ã–≤–æ—Ä–æ—Ç–∫–∏)</a></li>
                        <li><a href="#">–î–ª—è —Ç–µ–ª–∞ (–õ–æ—Å—å–æ–Ω—ã, –°–∫—Ä–∞–±—ã)</a></li>
                        <li><a href="#">–°–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</a></li>
                    </ul>
                    <h3>–£—Ö–æ–¥ –∑–∞ –≤–æ–ª–æ—Å–∞–º–∏</h3>
                    <ul>
                        <li><a href="#">–®–∞–º–ø—É–Ω–∏ –∏ –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä—ã</a></li>
                        <li><a href="#">–ú–∞—Å–∫–∏ –∏ –±–∞–ª—å–∑–∞–º—ã</a></li>
                        <li><a href="#">–°—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è —É–∫–ª–∞–¥–∫–∏</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–ú–∞–∫–∏—è–∂ –∏ –ü–∞—Ä—Ñ—é–º–µ—Ä–∏—è</h3>
                    <ul>
                        <li><a href="#">–î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∫–æ—Å–º–µ—Ç–∏–∫–∞</a></li>
                        <li><a href="#">–ü–∞—Ä—Ñ—é–º–µ—Ä–∏—è –º—É–∂—Å–∫–∞—è</a></li>
                        <li><a href="#">–ü–∞—Ä—Ñ—é–º–µ—Ä–∏—è –∂–µ–Ω—Å–∫–∞—è</a></li>
                    </ul>
                    <h3>–ú–∞–Ω–∏–∫—é—Ä –∏ –ø–µ–¥–∏–∫—é—Ä</h3>
                    <ul>
                        <li><a href="#">–õ–∞–∫–∏ –∏ –≥–µ–ª–∏</a></li>
                        <li><a href="#">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a></li>
                        <li><a href="#">–°—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è —Å–Ω—è—Ç–∏—è</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–°—Ä–µ–¥—Å—Ç–≤–∞ –≥–∏–≥–∏–µ–Ω—ã</h3>
                    <ul>
                        <li><a href="#">–î–ª—è –ø–æ–ª–æ—Å—Ç–∏ —Ä—Ç–∞</a></li>
                        <li><a href="#">–ì–µ–ª–∏ –¥–ª—è –¥—É—à–∞ –∏ –º—ã–ª–æ</a></li>
                        <li><a href="#">–î–µ–∑–æ–¥–æ—Ä–∞–Ω—Ç—ã</a></li>
                    </ul>
                </div>
            `,
            electronics: `
                <div class="menu-title-main">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</div>
                <div class="menu-category">
                    <h3>–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã –∏ —Å–≤—è–∑—å</h3>
                    <ul>
                        <li><a href="#">–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã Apple, Samsung, Xiaomi</a></li>
                        <li><a href="#">–°—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã</a></li>
                        <li><a href="#">SIM-–∫–∞—Ä—Ç—ã –∏ —Ç–∞—Ä–∏—Ñ—ã</a></li>
                    </ul>
                    <h3>–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –Ω–æ—É—Ç–±—É–∫–∏</h3>
                    <ul>
                        <li><a href="#">–ù–æ—É—Ç–±—É–∫–∏</a></li>
                        <li><a href="#">–ú–æ–Ω–æ–±–ª–æ–∫–∏</a></li>
                        <li><a href="#">–ö–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ</a></li>
                        <li><a href="#">–ú–æ–Ω–∏—Ç–æ—Ä—ã</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–ì–∞–¥–∂–µ—Ç—ã –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã</h3>
                    <ul>
                        <li><a href="#">–£–º–Ω—ã–µ —á–∞—Å—ã –∏ –±—Ä–∞—Å–ª–µ—Ç—ã</a></li>
                        <li><a href="#">–ù–∞—É—à–Ω–∏–∫–∏ –∏ –≥–∞—Ä–Ω–∏—Ç—É—Ä—ã</a></li>
                        <li><a href="#">–ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏</a></li>
                        <li><a href="#">–ó–∞—Ä—è–¥–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</a></li>
                        <li><a href="#">–ö–∞–±–µ–ª–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–Ω–∏–∫–∏</a></li>
                    </ul>
                    <h3>–¢–í –∏ –ê—É–¥–∏–æ/–í–∏–¥–µ–æ</h3>
                    <ul>
                        <li><a href="#">–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã</a></li>
                        <li><a href="#">–°–∞—É–Ω–¥–±–∞—Ä—ã –∏ –¥–æ–º–∞—à–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä—ã</a></li>
                        <li><a href="#">–ü—Ä–æ–µ–∫—Ç–æ—Ä—ã</a></li>
                    </ul>
                </div>
                <div class="menu-category">
                    <h3>–ö—Ä—É–ø–Ω–∞—è –±—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</h3>
                    <ul>
                        <li><a href="#">–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∏</a></li>
                        <li><a href="#">–°—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã</a></li>
                        <li><a href="#">–ü–ª–∏—Ç—ã –∏ –¥—É—Ö–æ–≤–∫–∏</a></li>
                        <li><a href="#">–ü–æ—Å—É–¥–æ–º–æ–µ—á–Ω—ã–µ –º–∞—à–∏–Ω—ã</a></li>
                    </ul>
                    <h3>–ú–µ–ª–∫–∞—è –±—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</h3>
                    <ul>
                        <li><a href="#">–ü—ã–ª–µ—Å–æ—Å—ã –∏ —Ä–æ–±–æ—Ç—ã</a></li>
                        <li><a href="#">–ö–æ—Ñ–µ–º–∞—à–∏–Ω—ã –∏ —á–∞–π–Ω–∏–∫–∏</a></li>
                        <li><a href="#">–£—Ç—é–≥–∏ –∏ –æ—Ç–ø–∞—Ä–∏–≤–∞—Ç–µ–ª–∏</a></li>
                    </ul>
                </div>
            `
        };
        function toggleMegaMenu(cat) {
            const menu = document.getElementById('mega-menu-container');
            if (menu.classList.contains('active') && menu.dataset.cat === cat) {
                menu.classList.remove('active');
            } else {
                if(menuData[cat]) {
                    menu.innerHTML = menuData[cat];
                    menu.dataset.cat = cat;
                    menu.classList.add('active');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>